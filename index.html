<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Create a simple CodeMirror instance -->

<title>Gator Study</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="node_modules/codemirror/lib/codemirror.js"></script>
<link rel="stylesheet" href="node_modules/codemirror/lib/codemirror.css">

<script src="./js/text_editor.js"></script>
<link rel = "stylesheet" type = "text/css" href = "./css/styles.css" />
<script language="JavaScript" type="text/javascript" src="./js/visualizer.js"></script>
<script language="JavaScript" type="text/javascript">
  
  var renderer = 0;

  function run() {
    var vertSrc = document.getElementById("code_vert").value;
    var fracSrc = document.getElementById("code_frag").value;

    renderer = new Renderer("myWebGLCanvas", vertSrc, fracSrc);
    renderer.init();
    renderer.display();
  }

  function updateRenderer() {
    var vertSrc = document.getElementById("code_vert").value;
    var fragSrc = document.getElementById("code_frag").value;
    renderer.updateShader(vertSrc, fragSrc);
    renderer.display();
  }

  var interval = setInterval(timerFunc, 40);

  function timerFunc() {
    var offset = 1.0;
    renderer.t += offset;
    renderer.display();
  }

  function modelChanged() {
    var d = document.getElementById("select_id2").value;
    renderer.updateModel(d);
    renderer.display();
  }

</script>

</head>

<body onload="run();">
        <div id="editor">
            
        </div>

        <div class="output">
                    <canvas id="myWebGLCanvas" height="300px" width="400px";>Your browser does not support the canvas element</canvas>
        </br>
            <div id="buttons">
                    <button type="button" onclick="updateRenderer()">Compile</button>
                    <select onchange="modelChanged()" id="select_id2">
                      <option value="./models/teapot.txt">Teapot</option>
                      <option value="./models/cube.txt">Cube</option>

                    </select>
            </div>
                   <textarea cols="40" rows="10" class="code_input_vert" id="code_vert">
                          attribute vec3 inputPosition;
                          attribute vec2 inputTexCoord;
                          attribute vec3 inputNormal;
                          
                          uniform mat4 projection, modelview, normalMat;
                          
                          varying vec3 normalInterp;
                          varying vec3 vertPos;
                          
                          void main(){
                              gl_Position = projection * modelview * vec4(inputPosition, 1.0);
                              vec4 vertPos4 = modelview * vec4(inputPosition, 1.0);
                              vertPos = vec3(vertPos4) / vertPos4.w;
                              normalInterp = vec3(normalMat * vec4(inputNormal, 0.0));
                          }
                              
                          </textarea>
                
                          <p id="code_vert_error" style="width: 200px;"></p>
                
                        <textarea cols="40" rows="10" class="code_input" id="code_frag">
                          precision mediump float; 
                
                          varying vec3 normalInterp;
                          varying vec3 vertPos;
                          
                          uniform int mode;
                          
                          const vec3 lightPos = vec3(1.0,1.0,1.0);
                          const vec3 ambientColor = vec3(0.3, 0.0, 0.0);
                          const vec3 diffuseColor = vec3(0.5, 0.0, 0.0);
                          const vec3 specColor = vec3(1.0, 1.0, 1.0);
                          
                          void main() {
                              vec3 normal = normalize(normalInterp);
                              vec3 lightDir = normalize(lightPos - vertPos);
                              vec3 reflectDir = reflect(-lightDir, normal);
                              vec3 viewDir = normalize(-vertPos);
                          
                              float lambertian = max(dot(lightDir,normal), 0.0);
                              float specular = 0.0;
                          
                              if(lambertian > 0.0) {
                                 float specAngle = max(dot(reflectDir, viewDir), 0.0);
                                 specular = pow(specAngle, 4.0);
                              }
                              gl_FragColor = vec4(ambientColor +
                                                lambertian*diffuseColor +
                                                specular*specColor, 1.0);
                          
                              // only ambient
                              if(mode == 2) gl_FragColor = vec4(ambientColor, 1.0);
                              // only diffuse
                              if(mode == 3) gl_FragColor = vec4(lambertian*diffuseColor, 1.0);
                              // only specular
                              if(mode == 4) gl_FragColor = vec4(specular*specColor, 1.0);
                          
                          }
                          </textarea>
                          <p id="code_frag_error" style="width: 200px;"></p>


            <div id="tutorial">
                <p>---tutorial</p>
                <canvas></canvas>
            </div>
        </div>

</body>

</html>